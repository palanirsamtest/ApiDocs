ControlTestPlanRelationships: &ControlTestPlanRelationships
  type: object
  description: The relationships associated with the resource.
  properties:
    control:
      type: object
      description: |
        Each test plan has an associated control. A control is a program, policy, routine, or activity that is intended to mitigate a risk.
      required:
        - data
      properties:
        data:
          type: object
          description: The data associated with the resource.
          required:
            - id
            - type
          properties:
            id:
              type: string
              description: The ID of the control.
              example: '1'
            type:
              type: string
              description: The classification of the object (`"controls"`).
              example: controls
    framework_origin: &FrameworkOriginRelationship
      type: object
      description: |
        In the Projects app, a project `control_test_plan` can have a related counterpart in an associated framework. The `framework_origin` attribute shows related counterpart of `control_test_plan` from a framework.
      required:
        - data
      properties:
        data:
          type: object
          description: The data associated with the resource.
          required:
            - id
            - type
          properties:
            id:
              type: string
              description: The ID of the parent control.
              example: '1'
            type:
              type: string
              description: The classification of the object (`"control_test_plans"`).
              example: control_test_plans

ControlTestPlan: &ControlTestPlan
  type: object
  description: The data associated with the resource.
  properties:
    id: &id
      type: string
      description: The ID of the requested resource.
      example: 1
    type: &type
      type: string
      description: The classification of the object (`"control_test_plans"`).
      example: control_test_plans
    attributes:
      type: object
      description: The attributes associated with the resource.
      properties:
        testing_method: &testing_method
          type: string
          nullable: true
          description: |
            The method specifying how evidence will be obtained. The exact values for this field depend on the <a href="
            https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-customize-terms" target="_blank">configuration of the project type</a>.

            >**Note**: If the `testing_method` field has been disabled in the project type, the field is hidden from the API response.
          example: Inspection
        total_sample_size: &total_sample_size
          type: integer
          description: |
            The total sample size, split among testing rounds. `total_sample_size` must be a value between `0` and `2147483647`.

            Sample size is set when a test plan is created the first time, which occurs when you create a control. The logic used to automatically set the sample size field is
            based on two control attribute fields: `frequency` and `type`. For more information, see <a href="
            https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-tests-walkthroughs" target="_blank">Executing procedures and testing
            controls</a>.

            >**Note**: If the `total_sample_size` field has been disabled in the project type, the field is hidden from the API response.
          format: int64
          example: 1
        test_steps: &test_steps
          type: string
          description: The steps or attributes associated with the test plan.
          maxLength: 524288
          example: '<h1>Heading</h1><p>Test Steps description.</p>'
        created_at: &created_at
          type: string
          description: The timestamp identifying when the test plan was created.
          example: '2019-02-09T13:17:26Z'
          format: date-time
        updated_at: &updated_at
          type: string
          description: The timestamp identifying when the test plan was updated.
          example: '2019-02-09T13:17:26Z'
          format: date-time
        custom_attributes: &custom_attributes
          type: array
          description: An array of custom attributes defined on the project type used by the project this control test is from. <a href="https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-project-types" target="_blank">Learn more about project types</a>. Make a PATCH request to modify the value of a custom attribute.
          items:
            type: object
            description: A user defined custom attribute value.
            properties:
              id:
                type: string
                description: The ID of this custom attribute. Optional if term is included.
                example: '42'
              term:
                type: string
                description: The user defined term used to identify this custom attribute. Optional if id is included.
                example: 'Custom Control Test Plan Attribute'
              value:
                type: array
                description: The value or values (for multiselect) for this custom attribute.
                example: ['Custom Select Option Text']
                items:
                  type: string
    relationships: *ControlTestPlanRelationships

ControlTestPlansIncludedResources: &ControlTestPlansIncludedResources
  type: array
  description: Included resources.
  items:
    type: object
  example:
    - id: 1
      type: 'controls'
      attributes:
        title: 'Control Title'
        description: 'Control description'
        control_id: '001'
        owner: 'thomas@sodor.ca'
        frequency: 'Daily'
        control_type: 'Application/System Control'
        prevent_detect: 'Prevent'
        method: 'Management Review'
        status: 'Key Control'
        position: '1'
        created_at: '2019-02-09T13:17:26Z'
        updated_at: '2019-02-09T13:17:26Z'
        custom_attributes:
          - id: 42
            term: 'Custom Control Attribute'
            value: ['Custom Select Option Text']
      relationships:
        objective:
          data:
            id: 1
            type: objectives
        walkthrough:
          data:
            id: 1
            type: walkthroughs
        control_test_plan:
          data:
            id: 1
            type: control_test_plans
        control_tests:
          data:
            - id: 1
              type: control_tests
        mitigations:
          data:
            - id: 1
              type: mitigations
        framework_origin:
          data:
            id: 1
            type: controls
        owner_user:
          data:
            id: '3NQ6XzAUxqJMnAQ7n4KF'
            type: users
    - id: 1
      type: 'objectives'
      attributes:
        title: 'Objective Title'
        reference: 'ITC'
        description: 'Objective description'
        division_department: 'Finance'
        owner: 'thomas@sodor.ca'
        executive_owner: 'henry@sodor.com'
        position: 1
        risk_control_matrix_id: '100'
        walkthrough_summary_id: '200'
        testing_round_1_id: '301'
        testing_round_2_id: '302'
        testing_round_3_id: '303'
        testing_round_4_id: '304'
        created_at: '2019-02-09T13:17:26Z'
        updated_at: '2019-02-09T13:17:26Z'
        custom_attributes:
          - id: 42
            term: 'Custom Objective Attribute'
            value: ['Custom Select Option Text']
        risk_assurance_data:
          inherent_risk: 1.1
          residual_risk: 1.1
          assurance: 0
      relationships:
        project:
          data:
            id: 1
            type: 'projects'
        framework:
          data:
            id: 1
            type: 'frameworks'
        framework_origin:
          data:
            id: 1
            type: 'objectives'
        assigned_user:
          data:
            id: '3NQ6XzAUxqJMnAQ7n4KF'
            type: 'users'
        entities:
          data:
            - id: 1
              type: 'entities'

Links: &Links
  type: object
  required:
    - next
    - prev
  properties:
    next:
      type: string
      description: Next page url
      nullable: true
      example: '/api/resource?page[number]=Mg=='
    prev:
      type: string
      description: Previous page url
      nullable: true
      example: null

UpdateControlTestPlanRequest:
  type: object
  required:
    - data
  properties:
    data:
      type: object
      description: The data associated with the resource.
      required:
        - id
        - type
      properties:
        id: *id
        type: *type
        attributes:
          type: object
          description: The attributes associated with the resource.
          properties:
            testing_method: *testing_method
            total_sample_size: *total_sample_size
            test_steps: *test_steps
            custom_attributes: *custom_attributes

GetControlTestPlanResponse:
  type: object
  required:
    - data
  properties:
    data: *ControlTestPlan

GetControlTestPlansResponse:
  type: object
  required:
    - data
    - links
  properties:
    data:
      type: array
      items: *ControlTestPlan
    included: *ControlTestPlansIncludedResources
    links: *Links
