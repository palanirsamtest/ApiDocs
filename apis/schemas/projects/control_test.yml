ControlTestRelationships: &ControlTestRelationships
  type: object
  description: The relationships associated with the resource.
  required:
    - control
  properties:
    control:
      type: object
      description: The attributes associated with the resource.
      required:
        - data
      properties:
        data:
          type: object
          description: The data associated with the resource.
          required:
            - id
            - type
          properties:
            id:
              type: string
              description: The ID of the control.
              example: '1'
            type:
              type: string
              description: The classification of the object (`"controls"`).
              example: controls
    assigned_user:
      type: object
      nullable: true
      description: |
        The person assigned to the control test. Only users assigned the Professional Manager, Professional User, or Contributor Tester role in the project
        can be specified. The user specified receives an email notification with a link to the control test, and has full read and write access to the control
        test.

        To return this field, you must specify the `fields[control_tests]=assigned_user` parameter in your request. For more information, see
        <a href="#section/Making-requests">Making requests</a>.
      required:
        - data
      properties:
        data:
          type: object
          description: The data associated with the resource.
          required:
            - id
            - type
          properties:
            id:
              type: string
              description:
                The unique identifier (UID) of the assigned user. For more information on obtaining this value, see
                <a href="#section/Making-requests">Making requests</a>.
              example: 3NQ6XzAUxqJMnAQ7n4KF
            type:
              type: string
              description: The classification of the object (`"users"`).
              example: users

ControlTest: &ControlTest
  type: object
  description: The data associated with the resource.
  required:
    - id
    - type
    - relationships
  properties:
    id: &id
      type: string
      description: The ID of the requested resource.
      example: 1
    type: &type
      type: string
      description: The classification of the object (`"control_tests"`).
      example: control_tests
    attributes:
      type: object
      description: The attributes associated with the resource.
      properties:
        testing_round_number: &testing_round_number
          type: integer
          description: |
            The specific testing round `(1-4)` that the control test belongs to. A control may have 0, 1, 2, or 4 testing rounds, depending upon the
            `number_of_testing_rounds` <a href="https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-update-project-settings" target="_blank">
            defined in the project settings</a>.

            The names for testing rounds are customizable and depend on the <a href="
            https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-customize-terms" target="_blank">configuration of the project type</a>.

            **Examples**

            1 testing round =
            **"Testing"** (`1`)

            2 testing rounds =
            **"Interim"** (`1`), **"Final"** (`2`)

            4 testing rounds =
            **"Q1"** (`1`), **"Q2"** (`2`), **"Q3"** (`3`), **"Q4"** (`4`)
          example: 1
          format: int64
        created_at: &created_at
          type: string
          description: The timestamp identifying when the control test was created.
          example: '2019-02-09T13:17:26Z'
          format: date-time
        updated_at: &updated_at
          type: string
          description: The timestamp identifying when the control test was updated.
          example: '2019-02-09T13:17:26Z'
          format: date-time
        not_applicable: &not_applicable
          type: boolean
          description: |
            `false` specifies that the control test is applicable to the testing round. `true` specifies that the control test
            is not applicable to the testing round. Only applicable control tests are included in
            <a href="https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-risk-assurance" target="_blank">assurance calculations</a>.
          example: false
        sample_size: &sample_size
          type: integer
          description: |
            The total sample size, split among testing rounds. `sample_size` must be a value between `0` and `2147483647`.

            Sample size is set when a
            test plan is created the first time, which occurs when you create a control. The logic used to automatically set the sample size field is
            based on two control attribute fields: `frequency` and `type`. For more information, see <a href="
            https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-tests-walkthroughs" target="_blank">Executing procedures and testing
            controls</a>.
          example: 24
          format: int64
          nullable: true
        testing_results: &testing_results
          type: string
          description: |
            A detailed evaluation that describes whether or not the control is operating effectively.
          maxLength: 524288
          example: '<h1>Heading</h1><p>Testing results description.</p>'
        testing_conclusion: &testing_conclusion
          type: boolean
          description: |
            A rating that specifies whether the control passes (`true`) or fails (`false`).

            The exact values for this field (E.g. "Operating Effectively" and "Exception(s) Noted") depend on the <a href="
            https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-customize-terms" target="_blank">configuration of the project type</a>.
            `true` maps to the first customizable value (E.g. "Operating Effectively") and `false` maps to the second customizable value (E.g.
            "Exception(s) Noted") in the project type.
          example: true
          nullable: true
        custom_attributes: &custom_attributes
          type: array
          description: An array of custom attributes defined on the project type used by the project this control test is from. <a href="https://help.highbond.com/helpdocs/highbond/en-us/Default.htm#cshid=pm-project-types" target="_blank">Learn more about project types</a>. Make a PATCH request to modify the value of a custom attribute.
          items:
            type: object
            description: A user defined custom attribute value.
            properties:
              id:
                type: string
                description: The ID of this custom attribute.  Optional if term is included.
                example: '42'
              term:
                type: string
                description: The user defined term used to identify this custom attribute. Optional if id is included.
                example: 'Custom Control Test Attribute'
              value:
                type: array
                description: The value or values (for multiselect) for this custom attribute.
                example: ['Custom Select Option Text']
                items:
                  type: string
    relationships: *ControlTestRelationships

ControlTestIncludedResources: &ControlTestIncludedResources
  type: array
  description: Included resources.
  items:
    type: object
  example:
    - id: 1
      type: controls
      attributes:
        title: 'Control Title'
        description: 'Control description'
        control_id: '001'
        owner: 'thomas@sodor.ca'
        frequency: 'Daily'
        control_type: 'Application/System Control'
        prevent_detect: 'Prevent'
        method: 'Management Review'
        status: 'Key Control'
        position: '1'
        created_at: '2019-02-09T13:17:26Z'
        updated_at: '2019-02-09T13:17:26Z'
        custom_attributes:
          - id: 2
            term: 'Custom Control Attribute'
            value: ['Custom Select Option Text']
      relationships:
        objective:
          data:
            id: 1
            type: objectives
        walkthrough:
          data:
            id: 1
            type: walkthroughs
        control_test_plan:
          data:
            id: 1
            type: control_test_plans
        control_tests:
          data:
            - id: 1
              type: control_tests
        mitigations:
          data:
            - id: 1
              type: mitigations
        framework_origin:
          data:
            id: 1
            type: controls
        owner_user:
          data:
            id: '3NQ6XzAUxqJMnAQ7n4KF'
            type: users
    - id: 1
      type: 'objectives'
      attributes:
        title: 'Objective Title'
        reference: 'ITC'
        description: 'Objective description'
        division_department: 'Finance'
        owner: 'thomas@sodor.ca'
        executive_owner: 'henry@sodor.com'
        position: 1
        risk_control_matrix_id: '100'
        walkthrough_summary_id: '200'
        testing_round_1_id: '301'
        testing_round_2_id: '302'
        testing_round_3_id: '303'
        testing_round_4_id: '304'
        created_at: '2019-02-09T13:17:26Z'
        updated_at: '2019-02-09T13:17:26Z'
        custom_attributes:
          - id: 42
            term: 'Custom Objective Attribute'
            value: ['Custom Select Option Text']
        risk_assurance_data:
          inherent_risk: 1.1
          residual_risk: 1.1
          assurance: 0
      relationships:
        project:
          data:
            id: 1
            type: 'projects'
        framework:
          data:
            id: 1
            type: 'frameworks'
        framework_origin:
          data:
            id: 1
            type: 'objectives'
        assigned_user:
          data:
            id: '3NQ6XzAUxqJMnAQ7n4KF'
            type: 'users'

Links: &Links
  type: object
  required:
    - next
    - prev
  properties:
    next:
      type: string
      description: Next page url
      nullable: true
      example: '/api/resource?page[number]=Mg=='
    prev:
      type: string
      description: Previous page url
      nullable: true
      example: null

UpdateControlTestRequest:
  type: object
  required:
    - data
  properties:
    data: &update_control_test_properties
      type: object
      description: The data associated with the resource.
      required:
        - id
        - type
        - attributes
        - relationships
      properties:
        id: *id
        type: *type
        attributes:
          type: object
          description: The attributes associated with the resource.
          required:
            - not_applicable
          properties:
            not_applicable: *not_applicable
            sample_size: *sample_size
            testing_results: *testing_results
            testing_conclusion: *testing_conclusion
            custom_attributes: *custom_attributes
        relationships: *ControlTestRelationships

BulkUpdateControlTestsRequest:
  type: object
  description: The data associated with the resource.
  required:
    - data
  properties:
    data:
      type: array
      description: The resource objects to update.
      items: *update_control_test_properties

GetControlTestResponse:
  type: object
  required:
    - data
  properties:
    data: *ControlTest

GetControlTestsResponse:
  type: object
  required:
    - data
    - links
  properties:
    data:
      type: array
      items: *ControlTest
    included: *ControlTestIncludedResources
    links: *Links

BulkGetControlTestsResponse:
  type: object
  required:
    - data
  properties:
    data:
      type: array
      description: The data included in the response.
      items:
        type: object
        required:
          - status
          - response
        properties:
          status:
            type: integer
            example: 200
          response:
            type: object
            required:
              - data
            properties:
              data: *ControlTest
